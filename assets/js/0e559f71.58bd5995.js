"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8024],{52064:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var t=a(85893),i=a(11151);const r={sidebar_position:3},o="CAS",s={id:"basicKnowledge/programmingLanguage/Java/\u5e76\u53d1/\u9501/CompareAndSwap",title:"CAS",description:"\u975e\u963b\u585e\u540c\u6b65\uff0cCompare-And-Swap\uff0c\u5148\u6bd4\u8f83\u518d\u4ea4\u6362",source:"@site/docs/basicKnowledge/programmingLanguage/Java/\u5e76\u53d1/\u9501/CompareAndSwap.mdx",sourceDirName:"basicKnowledge/programmingLanguage/Java/\u5e76\u53d1/\u9501",slug:"/basicKnowledge/programmingLanguage/Java/\u5e76\u53d1/\u9501/CompareAndSwap",permalink:"/kibou/docs/basicKnowledge/programmingLanguage/Java/\u5e76\u53d1/\u9501/CompareAndSwap",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"programmingLanguage",previous:{title:"\u9501\u7b80\u4ecb",permalink:"/kibou/docs/basicKnowledge/programmingLanguage/Java/\u5e76\u53d1/\u9501/\u9501\u7b80\u4ecb"},next:{title:"Synchronized",permalink:"/kibou/docs/basicKnowledge/programmingLanguage/Java/\u5e76\u53d1/\u9501/Synchronized"}},c={},d=[{value:"\u5927\u81f4\u6d41\u7a0b",id:"\u5927\u81f4\u6d41\u7a0b",level:2},{value:"java\u4e2d\u7684\u539f\u8bed",id:"java\u4e2d\u7684\u539f\u8bed",level:2},{value:"ABA\u95ee\u9898",id:"aba\u95ee\u9898",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2}];function l(e){const n=Object.assign({h1:"h1",blockquote:"blockquote",p:"p",h2:"h2",ul:"ul",li:"li",br:"br",pre:"pre",code:"code"},(0,i.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"cas",children:"CAS"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u975e\u963b\u585e\u540c\u6b65\uff0cCompare-And-Swap\uff0c\u5148\u6bd4\u8f83\u518d\u4ea4\u6362\n\u901a\u8fc7\u6bd4\u8f83\u5171\u4eab\u53d8\u91cf\u7684\u5f53\u524d\u503c\u4e0e\u671f\u671b\u503c\uff0c\u786e\u5b9a\u8bfb\u5199\u4e4b\u95f4\u662f\u5426\u6709\u7ade\u4e89\u7ebf\u7a0b\u5e72\u9884\uff0c\u5b9e\u73b0\u65e0\u9501\u7684\u5e76\u53d1\u64cd\u4f5c\n\u7c7b\u4f3csql\u91cc\u9762\u7684 update set f1 = 2 from t1 where f1 = 1"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u5927\u81f4\u6d41\u7a0b",children:"\u5927\u81f4\u6d41\u7a0b"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4e09\u4e2a\u64cd\u4f5c\u6570\uff1a\u5185\u5b58\u4f4d\u7f6e\uff08V\uff09\uff0c\u9884\u671f\u539f\u503c\uff08A\uff09\uff0c\u65b0\u503c\uff08B\uff09"}),"\n",(0,t.jsx)(n.li,{children:"\u5148\u8bfbA\uff0c\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\u540e\uff0c\u51c6\u5907\u4ee3\u5199\u5165\u7684B\uff0c\u6bd4\u8f83A\u548c\u5f53\u524d\u7684V\uff0c\u82e5\u76f8\u7b49\uff0c\u5c31\u8ba4\u4e3a\u8bfbA\u4e4b\u540e\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u5e72\u9884\uff0c\u628aB\u5199\u5165\u5230V\u7684\u4f4d\u7f6e"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"java\u4e2d\u7684\u539f\u8bed",children:"java\u4e2d\u7684\u539f\u8bed"}),"\n",(0,t.jsx)(n.p,{children:"unsafe\u7c7b\u4e2d\u7684"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"compareAndSwapObject"}),"\n",(0,t.jsx)(n.li,{children:"compareAndSwapInt"}),"\n",(0,t.jsx)(n.li,{children:"compareAndSwapLong"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"aba\u95ee\u9898",children:"ABA\u95ee\u9898"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u65e7\u7684\u9884\u671f\u503cA\u5728\u591a\u6b21\u4fee\u6539\u4e4b\u540e\u4fee\u6539\u56de\u4e86A"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u89e3\u51b3\uff1a\u901a\u8fc7\u63a7\u5236\u53d8\u91cf\u503c\u7684\u7248\u672c\u6765\u4fdd\u8bc1\u6b63\u786e\u6027\uff0c\u6bcf\u6b21\u4fee\u6539\u7248\u672c+1",(0,t.jsx)(n.br,{}),"\n","\u5982AtomicStampedReference"]}),"\n",(0,t.jsx)(n.h2,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'public class CASDemo {\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n\n        Thread thread1 = new Thread(() -> {\n            for (int i = 0; i < 10000; i++) {\n                int expectedValue = count;\n                int newValue = expectedValue + 1;\n                if (CAS.compareAndSwapInt(CASDemo.class, "count", expectedValue, newValue)) {\n                    // CAS \u64cd\u4f5c\u6210\u529f\n                } else {\n                    // CAS \u64cd\u4f5c\u5931\u8d25\uff0c\u91cd\u8bd5\n                }\n            }\n        });\n\n        Thread thread2 = new Thread(() -> {\n            for (int i = 0; i < 10000; i++) {\n                int expectedValue = count;\n                int newValue = expectedValue + 1;\n                if (CAS.compareAndSwapInt(CASDemo.class, "count", expectedValue, newValue)) {\n                    // CAS \u64cd\u4f5c\u6210\u529f\n                } else {\n                    // CAS \u64cd\u4f5c\u5931\u8d25\uff0c\u91cd\u8bd5\n                }\n            }\n        });\n\n        thread1.start();\n        thread2.start();\n\n        thread1.join();\n        thread2.join();\n\n        System.out.println("count = " + count); // 20000\n    }\n}\n\n'})})]})}const u=function(e={}){const{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(l,e)})):l(e)}},11151:(e,n,a)=>{a.d(n,{Zo:()=>s,ah:()=>r});var t=a(67294);const i=t.createContext({});function r(e){const n=t.useContext(i);return t.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const o={};function s({components:e,children:n,disableParentContext:a}){let s;return s=a?"function"==typeof e?e({}):e||o:r(e),t.createElement(i.Provider,{value:s},n)}}}]);